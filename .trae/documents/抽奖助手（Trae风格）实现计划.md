## 目标与交付物
- 构建一款“抽奖助手”Web应用，整体视觉与交互风格对齐 TRAE 官方界面。
- 交付：可运行应用、设计规范文档（含准确色值）、用户操作手册、测试报告摘要。

## 品牌色与UI规范获取
- 来源：基于 TRAE 官方站点 https://www.trae.ai/ 的实际 CSS/设计。
- 方法：实施阶段程序化抓取页面样式文件，解析 `:root` CSS 变量与按钮/链接/背景相关的颜色；同时人工复核以避免动态主题影响。
- 输出：HEX/RGB（必要时含 P3/alpha），给出命名约定（如 `--color-accent`, `--color-bg`, `--color-text`）。

## 技术栈（空仓库首选）
- 前端：React + TypeScript + Vite。
- 样式：CSS 变量 + Tailwind（仅做布局与响应式），保留品牌色在 CSS 变量统一管理。
- 状态与数据：轻量 Zustand 或直接组件内状态；持久化优先 `localStorage`，如名单/记录量大时切换 IndexedDB（`idb`）。
- 动画：CSS/WAAPI + 轻量 `canvas-confetti`（可替换为纯 CSS 粒子，以避免额外依赖）。
- 测试：Vitest（算法/逻辑），Playwright（跨设备/响应式）。

## 信息架构与页面
- 抽奖主界面：奖品卡、参与者导入区、模式选择、开始抽奖按钮、当前结果卡。
- 结果展示区：最近结果、中奖动画、重复抽奖入口。
- 历史记录区：分页/筛选（时间/奖品），支持导出 CSV。

## 数据模型
- `Prize`：`id`, `name`, `quantity`, `weight?`, `createdAt`。
- `Participant`：`id`, `name`, `meta?`（如部门/备注）。
- `DrawRecord`：`id`, `prizeId`, `participantId`, `timestamp`, `mode`（single/batch），`seed`（可选，用于可重放性）。

## 核心功能
- 奖品设置：增删改查；支持数量/权重（后续可选）。
- 名单导入：CSV/文本粘贴；去重、空行过滤；导入校验与预览。
- 抽奖模式：
  - 单次抽奖：一次抽取 1 人；可避免重复（可选开关）。
  - 批量抽奖：一次抽取 N 人；N 可配置且校验不超过名单长度。
  - 可重放：记录 `seed` 与参与者快照，允许复核。

## 随机性与公平性
- 随机源：`crypto.getRandomValues` 生成随机数，避免 `Math.random` 偏差。
- 算法：Fisher–Yates 洗牌（不放回抽样）或加权随机（如启用权重时）。
- 验证：
  - 统计测试：大样本模拟（≥100k 次）分布均匀性（卡方/频数偏差）。
  - 边界用例：空名单、名单长度 < 批量数、重复抽取、全量抽尽等。

## 动画与交互
- 中奖弹出卡片 + 轻量粒子特效；按钮 hover/press 反馈与渐变发光；结果进场/退场。
- 过渡标准：`200–300ms` 过渡、`ease-out`，保证响应速度与质感。

## 响应式规范
- 断点：`sm`（≤640px）、`md`（≤768px）、`lg`（≥1024px）。
- 布局：移动端单列；桌面端左右分栏（主抽奖区 + 历史记录）。
- 点击目标：≥44px；字体与对比度遵循可读性标准。

## 数据持久化
- 首版：`localStorage` 按键空间：`prizes`, `participants`, `records`。
- 扩展：超过阈值（如记录 > 5k）自动迁移到 IndexedDB；提供导入/导出。

## 设计规范文档（示例结构）
- 品牌色：主色（accent）、背景色、文本色、边框/分割线色；按钮/链接/标签的状态色（默认/hover/active/disabled）。
- 字体与字号：与 TRAE 站点一致或近似（如 Inter/系统字体），层级与行高。
- 组件规范：按钮、卡片、输入框、标签、弹框；圆角、阴影、密度标准。

## 用户操作手册（要点）
- 奖品创建与编辑、名单导入与校验；单次/批量抽奖；历史记录检索与导出；可重放性说明与随机性声明。

## 测试计划
- 设备/视口：iPhone/Android 常见尺寸 + 桌面 `lg`；截图比对与关键断点验证。
- 算法随机性：模拟试验并输出分布统计与阈值；重复性与去重策略验证。
- 边界条件：空名单、批量数超限、重复导入、含特殊字符的姓名等。

## 项目结构
- `src/`：`app`, `components`, `pages`, `styles`（CSS 变量）, `lib`（random/import/persist）。
- `tests/`：算法与组件测试；`e2e/`：Playwright 场景。

## 实施步骤
1) 建立项目骨架与 CSS 变量体系；占位色值先行，待抓取后替换。
2) 奖品/参与者模块与导入校验；本地持久化。
3) 抽奖算法（CSPRNG + Fisher–Yates）；单次/批量模式与记录。
4) 动画与结果展示；历史记录页与导出。
5) 获取并落地 TRAE 准确色值；更新设计规范文档。
6) 编写用户手册；完善测试与统计验证；交付可运行版本。

## 风险与备选
- 如果 TRAE 站点存在动态主题/多色方案：以 CSS 变量抓取为准并记录来源；无法直接获取时采用官方素材/设计稿比对取值，保留来源说明。
- 如需无第三方库：动画改用纯 CSS/WAAPI；持久化保持原生 IndexedDB。
